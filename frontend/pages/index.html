<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首頁 - 辯論平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../static/css/styles.css">
</head>
<body class="bg-gray-50">
    <div id="navbar"></div>

    <div class="container mx-auto px-4 py-8">
        <!-- 用戶資訊卡片 -->
        <div class="user-profile-card">
            <div class="flex items-center space-x-6">
                <div class="relative">
                    <img id="userAvatar" src="" alt="頭像" class="w-24 h-24 rounded-full border-4 border-white shadow-xl">
                    <div class="absolute -bottom-2 -right-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">
                        #<span id="userRank">-</span>
                    </div>
                </div>
                <div class="flex-1">
                    <h2 id="userName" class="text-3xl font-bold text-white mb-3"></h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="stat-box">
                            <div class="stat-label">Rating</div>
                            <div class="stat-value text-yellow-300" id="userRating">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">勝場</div>
                            <div class="stat-value text-green-300" id="userWins">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">敗場</div>
                            <div class="stat-value text-red-300" id="userLosses">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">平手</div>
                            <div class="stat-value text-gray-300" id="userDraws">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 快速導航 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <a href="debates.html" class="nav-card nav-card-debates">
                <div class="nav-card-icon">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h3 class="nav-card-title">進行中的辯論</h3>
                <p class="nav-card-desc">查看並參與正在進行的辯論</p>
                <div class="nav-card-arrow">→</div>
            </a>
            <a href="topics.html" class="nav-card nav-card-topics">
                <div class="nav-card-icon">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
                        <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/>
                    </svg>
                </div>
                <h3 class="nav-card-title">話題廣場</h3>
                <p class="nav-card-desc">瀏覽話題並提交新議題</p>
                <div class="nav-card-arrow">→</div>
            </a>
            <a href="ranking.html" class="nav-card nav-card-ranking">
                <div class="nav-card-icon">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                    </svg>
                </div>
                <h3 class="nav-card-title">排行榜</h3>
                <p class="nav-card-desc">查看玩家實力排名</p>
                <div class="nav-card-arrow">→</div>
            </a>
        </div>

        <!-- 最新辯論 -->
        <div class="latest-debates-section">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-3xl font-bold text-gray-900">最新辯論</h3>
                <a href="debates.html" class="text-blue-600 hover:text-blue-700 font-semibold flex items-center gap-2">
                    查看全部
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </a>
            </div>
            <div id="latestDebates" class="space-y-4">
                <!-- 動態載入 -->
            </div>
        </div>
    </div>

    <script src="../static/js/api.js"></script>
    <script src="../static/js/utils.js"></script>
    <script>
        if (!checkAuth()) {
            // 如果未登入會自動重定向到登入頁
        }

        async function loadUserData() {
            try {
                const data = await UserAPI.getCurrentUser();
                document.getElementById('userAvatar').src = data.avatar || 'https://via.placeholder.com/80';
                document.getElementById('userName').textContent = data.nickname;
                document.getElementById('userRating').textContent = data.rating;
                document.getElementById('userWins').textContent = data.wins;
                document.getElementById('userLosses').textContent = data.losses;
                document.getElementById('userDraws').textContent = data.draws;
                setCurrentUser(data);
            } catch (error) {
                showError('載入用戶資料失敗');
                console.error(error);
            }
        }

        async function loadLatestDebates() {
            try {
                const data = await DebateAPI.getDebates('ONGOING');
                const container = document.getElementById('latestDebates');

                if (data.debates.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">目前沒有進行中的辯論</p>';
                    return;
                }

                container.innerHTML = data.debates.slice(0, 5).map(debate => `
                    <div class="debate-item">
                        <div class="flex justify-between items-start mb-3">
                            <h4 class="debate-item-title">${debate.topic_title}</h4>
                            <span class="badge ${getStatusColor(debate.status)}">${getStatusText(debate.status)}</span>
                        </div>
                        <div class="debate-item-players">
                            <div class="player-tag player-pros">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                                ${debate.pros_nickname}
                            </div>
                            <span class="vs-text">VS</span>
                            <div class="player-tag player-cons">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                                ${debate.cons_nickname}
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-3">
                            <div class="round-indicator">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                                第 ${debate.round_count} 回合
                            </div>
                            <a href="debate.html?id=${debate.debate_id}" class="debate-link">
                                查看詳情
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showError('載入辯論列表失敗');
                console.error(error);
            }
        }

        initPage();
        loadUserData();
        loadLatestDebates();
    </script>
</body>
</html>